// Generated by CoffeeScript 2.4.1
(function() {
  'use strict';
  var CND, L, PATH, acquire_path, acquire_patterns, assign, badge, debug, declare, echo, glob, help, info, is_bound, isa, jr, minimatch, override_sym, rpr, size_of, type_of, types, urge, validate, warn, whisper;

  //###########################################################################################################
  CND = require('cnd');

  rpr = CND.rpr;

  badge = 'PIPEDREAMS/MAIN';

  debug = CND.get_logger('debug', badge);

  warn = CND.get_logger('warn', badge);

  info = CND.get_logger('info', badge);

  urge = CND.get_logger('urge', badge);

  help = CND.get_logger('help', badge);

  whisper = CND.get_logger('whisper', badge);

  echo = CND.echo.bind(CND);

  //...........................................................................................................
  PATH = require('path');

  glob = require('glob');

  minimatch = require('minimatch');

  ({assign, jr} = CND);

  override_sym = Symbol.for('override');

  L = this;

  //...........................................................................................................
  types = require('./_types');

  ({isa, validate, declare, size_of, type_of} = types);

  //-----------------------------------------------------------------------------------------------------------
  is_bound = function(f) {
    return ((rpr(f)).match(/^\[Function: (?:bound )+\]$/)) != null;
  };

  //-----------------------------------------------------------------------------------------------------------
  acquire_patterns = function(target, patterns, include = null) {
    var i, len, path, paths, settings;
    if (include != null) {
      validate.function(include);
    }
    settings = {
      cwd: PATH.join(__dirname),
      deep: false,
      absolute: true
    };
    paths = glob.sync(patterns, settings);
//.........................................................................................................
    for (i = 0, len = paths.length; i < len; i++) {
      path = paths[i];
      if ((include != null) && !include(path)) {
        continue;
      }
      acquire_path(target, path);
    }
    return null;
  };

  //-----------------------------------------------------------------------------------------------------------
  acquire_path = function(target, path) {
    var key, module, value;
    module = require(path);
    for (key in module) {
      value = module[key];
      if ((L[key] != null) && !value[override_sym]) {
        throw new Error(`duplicate key ${rpr(key)}`);
      }
      if ((CND.isa_function(value)) && !is_bound(value)) {
        module[key] = value.bind(module);
      }
      target[key] = module[key];
    }
    return null;
  };

  //###########################################################################################################
  /* Gather methods from submodules, bind all methods to respective submodule, reflect public names into
  main module. */
  // L.R   = {}
  L.XE = {};

  acquire_path(L, 'pipestreams');

  acquire_patterns(L, '*.js', function(path) {
    var name;
    name = PATH.basename(path);
    if (name.startsWith('_')) {
      return false;
    }
    if (name === 'main.js') {
      return false;
    }
    if (name === 'overrides.js') {
      // return false if name is 'recycle.js'
      return false;
    }
    if (name === 'xemitter.js') {
      return false;
    }
    return true;
  });

  // acquire_patterns  L.R,  'recycle.js'
  acquire_patterns(L.XE, 'xemitter.js');

  acquire_patterns(L, 'overrides.js');

}).call(this);

//# sourceMappingURL=main.js.map
